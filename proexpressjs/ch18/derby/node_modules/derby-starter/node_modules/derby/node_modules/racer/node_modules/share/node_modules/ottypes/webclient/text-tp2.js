(function(){var e={exports:{}};e.exports;var t=e.exports={name:"text-tp2",tp2:!0,uri:"http://sharejs.org/types/text-tp2v1",create:function(e){if(null==e)e="";else if("string"!=typeof e)throw Error("Initial data must be a string");return{charLength:e.length,totalLength:e.length,data:e.length?[e]:[]}},serialize:function(e){if(!e.data)throw Error("invalid doc snapshot");return e.data},deserialize:function(e){var r=t.create();r.data=e;for(var n=0;e.length>n;n++){var o=e[n];"string"==typeof o?(r.charLength+=o.length,r.totalLength+=o.length):r.totalLength+=o}return r}},r=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},n=function(e){if(!r(e))throw Error("Op must be an array of components");for(var t=null,n=0;e.length>n;n++){var o=e[n];if("object"==typeof o)if(void 0!==o.i){if(!("string"==typeof o.i&&o.i.length>0||"number"==typeof o.i&&o.i>0))throw Error("Inserts must insert a string or a +ive number")}else{if(void 0===o.d)throw Error("Operation component must define .i or .d");if(!("number"==typeof o.d&&o.d>0))throw Error("Deletes must be a +ive number")}else{if("number"!=typeof o)throw Error("Op components must be objects or numbers");if(0>=o)throw Error("Skip components must be a positive number");if("number"==typeof t)throw Error("Adjacent skip components should be combined")}t=o}},o=t._takeDoc=function(e,t,r,n){if(t.index>=e.data.length)throw Error("Operation goes past the end of the document");var o,i=e.data[t.index];o="string"==typeof i?null!=r?i.slice(t.offset,t.offset+r):i.slice(t.offset):null==r||n?i-t.offset:Math.min(r,i-t.offset);var f=o.length||o;return(i.length||i)-t.offset>f?t.offset+=f:(t.index++,t.offset=0),o},i=t._appendDoc=function(e,t){if(0!==t&&""!==t){"string"==typeof t?(e.charLength+=t.length,e.totalLength+=t.length):e.totalLength+=t;var r=e.data;0===r.length?r.push(t):typeof r[r.length-1]==typeof t?r[r.length-1]+=t:r.push(t)}};t.apply=function(e,f){if(null==e.totalLength||null==e.charLength||!r(e.data))throw Error("Snapshot is invalid");n(f);for(var l=t.create(),a={index:0,offset:0},s=0;f.length>s;s++){var u,h,d=f[s];if("number"==typeof d)for(u=d;u>0;)h=o(e,a,u),i(l,h),u-=h.length||h;else if(void 0!==d.i)i(l,d.i);else if(void 0!==d.d){for(u=d.d;u>0;)h=o(e,a,u),u-=h.length||h;i(l,d.d)}}return l};var f=t._append=function(e,t){var r;0===t||""===t.i||0===t.i||0===t.d||(0===e.length?e.push(t):(r=e[e.length-1],"number"==typeof t&&"number"==typeof r?e[e.length-1]+=t:null!=t.i&&null!=r.i&&typeof r.i==typeof t.i?r.i+=t.i:null!=t.d&&null!=r.d?r.d+=t.d:e.push(t)))},l=function(e,t,r,n){if(t.index===e.length)return null;var o,i,f=e[t.index],l=t.offset;if("number"==typeof(o=f)||"number"==typeof(o=f.i)||null!=(o=f.d)){var a;return null==r||r>=o-l||n&&null!=f.i?(a=o-l,++t.index,t.offset=0):(t.offset+=r,a=r),null!=f.i?{i:a}:null!=f.d?{d:a}:a}return null==r||r>=f.i.length-l||n?(i={i:f.i.slice(l)},++t.index,t.offset=0):(i={i:f.i.slice(l,l+r)},t.offset+=r),i},a=function(e){return"number"==typeof e?e:"string"==typeof e.i?e.i.length:e.d||e.i};t.normalize=function(e){for(var t=[],r=0;e.length>r;r++)f(t,e[r]);return t};var s=function(e,t,r,o){n(e),n(t);for(var i=[],s={index:0,offset:0},u=0;t.length>u;u++){var h,d=t[u],p=a(d);if(null!=d.i)if(r){if("left"===o)for(var g;(g=e[s.index])&&null!=g.i;)f(i,l(e,s));f(i,p)}else for(;p>0;){if(h=l(e,s,p,!0),null===h)throw Error("The transformed op is invalid");if(null!=h.d)throw Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");"number"==typeof h?p-=h:f(i,h)}else for(;p>0;){if(h=l(e,s,p,!0),null===h)throw Error("The op traverses more elements than the document has");f(i,h),h.i||(p-=a(h))}}for(var d;d=l(e,s);){if(void 0===d.i)throw Error("Remaining fragments in the op: "+d);f(i,d)}return i};t.transform=function(e,t,r){if("left"!=r&&"right"!=r)throw Error("side ("+r+") should be 'left' or 'right'");return s(e,t,!0,r)},t.prune=function(e,t){return s(e,t,!1)},t.compose=function(e,t){if(null==e)return t;n(e),n(t);for(var r,o=[],i={index:0,offset:0},s=0;t.length>s;s++){r=t[s];var u,h;if("number"==typeof r)for(u=r;u>0;){if(h=l(e,i,u),null===h)throw Error("The op traverses more elements than the document has");f(o,h),u-=a(h)}else if(void 0!==r.i)f(o,{i:r.i});else for(u=r.d;u>0;){if(h=l(e,i,u),null===h)throw Error("The op traverses more elements than the document has");var d=a(h);void 0!==h.i?f(o,{i:d}):f(o,{d:d}),u-=d}}for(;r=l(e,i);){if(void 0===r.i)throw Error("Remaining fragments in op1: "+r);f(o,r)}return o};var u=window.ottypes=window.ottypes||{},h=e.exports;u[h.name]=h,h.uri&&(u[h.uri]=h)})();