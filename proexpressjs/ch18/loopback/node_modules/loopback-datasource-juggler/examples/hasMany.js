var DataSource = require('../index').DataSource;
var ds = new DataSource('memory');


var Physician = ds.createModel('Physician', {
  name: String
});

var Patient = ds.createModel('Patient', {
  name: String
});

var Appointment = ds.createModel('Appointment', {
  physicianId: Number,
  patientId: Number,
  appointmentDate: Date
});

Appointment.belongsTo(Patient);
Appointment.belongsTo(Physician);

Physician.hasMany(Patient, {through: Appointment});
Patient.hasMany(Physician, {through: Appointment});

Physician.create({name: 'Dr John'}, function (err, physician1) {
  Physician.create({name: 'Dr Smith'}, function (err, physician2) {
    Patient.create({name: 'Mary'}, function (err, patient1) {
      Patient.create({name: 'Ben'}, function (err, patient2) {
        Appointment.create({appointmentDate: new Date(), physicianId: physician1.id, patientId: patient1.id},
          function (err, appt1) {
            Appointment.create({appointmentDate: new Date(), physicianId: physician1.id, patientId: patient2.id},
              function (err, appt2) {
                physician1.patients(console.log);
                physician1.patients.add(patient2);
                physician1.patients.create({name: 'James'}, console.log);
              });
          });
      });
    });
  });
});

